(this["webpackJsonpreact-typescript-starter-pack"]=this["webpackJsonpreact-typescript-starter-pack"]||[]).push([[0],{21:function(e,t,n){},24:function(e,t,n){"use strict";n.r(t);var c=n(10),a=(n(19),n(20),n(21),n(3)),r=n.n(a),o=n(7),i=n(5),s=n(2),u=n(4),l=n.n(u),d=n(1),f=n.n(d),j="https://mate.academy/students-api";function b(e){return new Promise((function(t){setTimeout(t,e)}))}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c={method:t};return n&&(c.body=JSON.stringify(n),c.headers={"Content-Type":"application/json; charset=UTF-8"}),b(300).then((function(){return fetch(j+e,c)})).then((function(e){if(!e.ok)throw new Error;return e.json()}))}var m=function(e){return p(e)},h=function(e,t){return p(e,"POST",t)},O=function(e,t){return p(e,"PATCH",t)},x=function(e){return p(e,"DELETE")},v=function(e){return x("/todos/".concat(e))},g=function(e,t){return O("/todos/".concat(e),t)},y=function(){var e=Object(i.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m("/users?email=".concat(t));case 2:return n=e.sent,e.abrupt("return",n[0]||null);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=Object(i.a)(r.a.mark((function e(t){var n,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.email,c=t.name,e.abrupt("return",h("/users",{email:n,name:c}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=n(0),_=function(e){var t=e.onLogin,n=Object(d.useState)(""),c=Object(s.a)(n,2),a=c[0],o=c[1],u=Object(d.useState)(""),f=Object(s.a)(u,2),j=f[0],b=f[1],p=Object(d.useState)(!1),m=Object(s.a)(p,2),h=m[0],O=m[1],x=Object(d.useState)(!1),v=Object(s.a)(x,2),g=v[0],_=v[1],w=Object(d.useState)(""),C=Object(s.a)(w,2),S=C[0],T=C[1],E=function(e){localStorage.setItem("user",JSON.stringify(e)),t(e)};Object(d.useEffect)((function(){var e=localStorage.getItem("user");if(e)try{var n=JSON.parse(e);t(n)}catch(c){}}),[]);var F=function(){var e=Object(i.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(a);case 2:(t=e.sent)?E(t):O(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=Object(i.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),T(""),_(!0),e.prev=3,!h){e.next=9;break}return e.next=7,N({name:j,email:a}).then(E);case 7:e.next=11;break;case 9:return e.next=11,F();case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),T("Something went wrtong");case 16:return e.prev=16,_(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[3,13,16,19]])})));return function(t){return e.apply(this,arguments)}}();return Object(k.jsxs)("form",{onSubmit:L,className:"box mt-5",children:[Object(k.jsx)("h1",{className:"title is-3",children:h?"You need to register":"Log in to open todos"}),Object(k.jsxs)("div",{className:"field",children:[Object(k.jsx)("label",{className:"label",htmlFor:"user-email",children:"Email"}),Object(k.jsxs)("div",{className:l()("control has-icons-left",{"is-loading":g}),children:[Object(k.jsx)("input",{type:"email",id:"user-email",className:l()("input",{"is-danger":!h&&S}),placeholder:"Enter your email",disabled:g||h,value:a,required:!0,onChange:function(e){return o(e.target.value)}}),Object(k.jsx)("span",{className:"icon is-small is-left",children:Object(k.jsx)("i",{className:"fas fa-envelope"})})]}),!h&&S&&Object(k.jsx)("p",{className:"help is-danger",children:S})]}),h&&Object(k.jsxs)("div",{className:"field",children:[Object(k.jsx)("label",{className:"label",htmlFor:"user-name",children:"Your Name"}),Object(k.jsxs)("div",{className:l()("control has-icons-left",{"is-loading":g}),children:[Object(k.jsx)("input",{type:"text",id:"user-name",className:l()("input",{"is-danger":h&&S}),placeholder:"Enter your name",required:!0,minLength:4,disabled:g,value:j,onChange:function(e){return b(e.target.value)}}),Object(k.jsx)("span",{className:"icon is-small is-left",children:Object(k.jsx)("i",{className:"fas fa-user"})})]}),h&&S&&Object(k.jsx)("p",{className:"help is-danger",children:S})]}),Object(k.jsx)("div",{className:"field",children:Object(k.jsx)("button",{type:"submit",className:l()("button is-primary",{"is-loading":g}),children:h?"Register":"Login"})})]})},w=f.a.createContext(null),C=function(e){var t=e.children,n=Object(d.useState)(null),c=Object(s.a)(n,2),a=c[0],r=c[1];return a?Object(k.jsx)(w.Provider,{value:a,children:t}):Object(k.jsx)(_,{onLogin:r})},S=function(e){var t=e.todo,n=e.removeTodo,c=e.changeTodo,a=e.loadingTodosId,r=t.title,o=t.completed,i=t.id,u=Object(d.useRef)(null),f=Object(d.useState)(!1),j=Object(s.a)(f,2),b=j[0],p=j[1],m=Object(d.useState)(r),h=Object(s.a)(m,2),O=h[0],x=h[1];Object(d.useEffect)((function(){u.current&&u.current.focus()}),[b]);var v=function(){O||n(i),O!==r?(c(i,{title:O}),p(!1)):p(!1)};return Object(k.jsxs)("div",{"data-cy":"Todo",className:l()("todo",{completed:o}),children:[Object(k.jsx)("label",{className:"todo__status-label",children:Object(k.jsx)("input",{"data-cy":"TodoStatus",type:"checkbox",className:"todo__status",defaultChecked:o,onChange:function(){return c(i,{completed:!o})}})}),b?Object(k.jsx)("form",{onSubmit:function(e){e.preventDefault(),v()},children:Object(k.jsx)("input",{"data-cy":"TodoTitleField",type:"text",className:"todo__title-field",ref:u,placeholder:"Empty todo will be deleted",value:O,onChange:function(e){x(e.target.value)},onBlur:function(){return v()},onKeyDown:function(e){"Escape"===e.key&&(p(!1),x(r))}})}):Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("span",{"data-cy":"TodoTitle",className:"todo__title",onDoubleClick:function(){return p(!0)},children:r}),Object(k.jsx)("button",{type:"button",className:"todo__remove","data-cy":"TodoDeleteButton",onClick:function(){return n(i)},children:"\xd7"})]}),Object(k.jsxs)("div",{"data-cy":"TodoLoader",className:l()("modal overlay",{"is-active":a.includes(i)}),children:[Object(k.jsx)("div",{className:"modal-background has-background-white-ter"}),Object(k.jsx)("div",{className:"loader"})]})]})},T=function(){var e=Object(d.useContext)(w),t=Object(d.useState)([]),n=Object(s.a)(t,2),c=n[0],a=n[1],u=Object(d.useState)(""),f=Object(s.a)(u,2),j=f[0],b=f[1],p=Object(d.useState)(""),O=Object(s.a)(p,2),x=O[0],y=O[1],N=Object(d.useState)(!0),_=Object(s.a)(N,2),C=_[0],T=_[1],E=Object(d.useState)(""),F=Object(s.a)(E,2),L=F[0],I=F[1],D=Object(d.useState)(!1),A=Object(s.a)(D,2),B=A[0],J=A[1],P=Object(d.useState)([]),R=Object(s.a)(P,2),U=R[0],q=R[1],H=c.filter((function(e){switch(L){case"active":return!e.completed;case"completed":return e.completed;default:return c}})),Y=function(e){y(e),setTimeout((function(){return y("")}),3e3)},G=function(){var t=Object(i.a)(r.a.mark((function t(n){var i,s,u;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),j){t.next=4;break}return Y("Title cant be empty"),t.abrupt("return");case 4:if(e){t.next=6;break}return t.abrupt("return");case 6:return i=-c.length,s={id:i,userId:e.id,title:j,completed:!1},a((function(e){return[].concat(Object(o.a)(e),[s])})),q((function(e){return[].concat(Object(o.a)(e),[i])})),t.prev=10,t.next=13,r=e.id,h("/todos",{userId:r,title:j,completed:!1});case 13:u=t.sent,a((function(e){return e.map((function(e){return e.id===i?u:e}))})),t.next=21;break;case 17:t.prev=17,t.t0=t.catch(10),a((function(e){return e.filter((function(e){return e.id!==i}))})),Y("Unable to add todo");case 21:b(""),q((function(e){return e.filter((function(e){return e!==s.id}))}));case 23:case"end":return t.stop()}var r}),t,null,[[10,17]])})));return function(e){return t.apply(this,arguments)}}(),K=Object(d.useCallback)(function(){var e=Object(i.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q((function(e){return[].concat(Object(o.a)(e),[t])})),e.prev=1,e.next=4,v(t);case 4:a((function(e){return e.filter((function(e){return e.id!==t}))})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),Y("Unable to delete todo");case 10:q((function(e){return e.filter((function(e){return e!==t}))}));case 11:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}(),[v]),W=Object(d.useCallback)(function(){var e=Object(i.a)(r.a.mark((function e(t,n){var c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q((function(e){return[].concat(Object(o.a)(e),[t])})),e.next=3,g(t,n);case 3:c=e.sent,a((function(e){return e.map((function(e){return e.id===t?c:e}))})),q((function(e){return e.filter((function(e){return e!==t}))}));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[g]);return Object(d.useEffect)((function(){var t;e&&(t=e.id,m("/todos?userId=".concat(t))).then(a)}),[e]),Object(k.jsxs)("div",{className:"todoapp",children:[Object(k.jsx)("h1",{className:"todoapp__title",children:"todos"}),Object(k.jsxs)("div",{className:"todoapp__content",children:[Object(k.jsxs)("header",{className:"todoapp__header",children:[c.length>0&&Object(k.jsx)("button",{"data-cy":"ToggleAllButton",type:"button",onClick:function(){J((function(e){return!e})),c.map((function(e){return W(e.id,{completed:B,loading:B})}))},className:l()("todoapp__toggle-all",{active:c.filter((function(e){return e.completed})).length===c.length})}),Object(k.jsx)("form",{onSubmit:G,children:Object(k.jsx)("input",{"data-cy":"NewTodoField",type:"text",className:"todoapp__new-todo",placeholder:"What needs to be done?",value:j,onChange:function(e){b(e.target.value),y("")}})})]}),Object(k.jsx)("section",{className:"todoapp__main","data-cy":"TodoList",children:H.map((function(e){return Object(k.jsx)(S,{todo:e,removeTodo:K,changeTodo:W,loadingTodosId:U},e.id)}))}),c.length>0&&Object(k.jsxs)("footer",{className:"todoapp__footer","data-cy":"Footer",children:[Object(k.jsx)("span",{className:"todo-count","data-cy":"todosCounter",children:"".concat(c.filter((function(e){return!e.completed})).length," items left")}),Object(k.jsxs)("nav",{className:"filter","data-cy":"Filter",children:[Object(k.jsx)("a",{"data-cy":"FilterLinkAll",href:"#/",className:l()("filter__link",{selected:"all"===L}),onClick:function(){return I("all")},children:"All"}),Object(k.jsx)("a",{"data-cy":"FilterLinkActive",href:"#/active",className:l()("filter__link",{selected:"active"===L}),onClick:function(){return I("active")},children:"Active"}),Object(k.jsx)("a",{"data-cy":"FilterLinkCompleted",href:"#/completed",className:l()("filter__link",{selected:"completed"===L}),onClick:function(){return I("completed")},children:"Completed"})]}),Object(k.jsx)("button",{"data-cy":"ClearCompletedButton",type:"button",className:"todoapp__clear-completed",hidden:0===c.filter((function(e){return e.completed})).length,onClick:function(){J((function(e){return!e})),a((function(e){return e.filter((function(e){return e.completed&&K(e.id),e}))}))},children:"Clear completed"})]})]}),x&&Object(k.jsxs)("div",{"data-cy":"ErrorNotification",className:"notification is-danger is-light has-text-weight-normal",children:[Object(k.jsx)("button",{"data-cy":"HideErrorButton",type:"button",className:"delete",onClick:function(){T((function(e){return!e})),y("")},hidden:C}),x]})]})},E=function(){return Object(k.jsx)(C,{children:Object(k.jsx)(T,{})})};Object(c.createRoot)(document.getElementById("root")).render(Object(k.jsx)(E,{}))}},[[24,1,2]]]);
//# sourceMappingURL=main.6b5bc491.chunk.js.map